<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.cafe24.smart_academy.academy_manage.member.mapper.MemberMapper">
	
	<!-- 로그인 테이블에서 해당 아이디 존재여부 확인 -->
	<select id="memberLoginInfoById" parameterType="String" resultType="String">
		select
			member_id
		from
			member_login
		where
			member_id = #{memberId}
	</select>
	
	
	<!-- 로그인 테이블에서 아이디와 비밀번호 일치 여부 확인 -->
	<select id="memberLogin" parameterType="com.cafe24.smart_academy.academy_manage.member.vo.MemberLogin"
			resultType="com.cafe24.smart_academy.academy_manage.member.vo.MemberLogin">
		select
			 member_id			AS memberId
			,member_level		AS memberLevel
		from
			member_login
		where
			member_id = #{memberId}
		and
			member_pw = #{memberPw};
	</select>
	
	
	<!-- 로그인 테이블과 회원신상정보 테이블을 아이디로 조인하여 값을 가지고 온다. -->
	<select id="memberLoginInfo" parameterType="String" resultType="map">
		select
			 m.member_id			AS memberId
			,m.member_level			AS memberLevel
			,me.member_name			AS memberName
		from
			member_login m
		inner join
			member me
		on
			m.member_id = me.member_id
		where
			m.member_id = #{memberId};
	</select>
	
	
	<!-- 관리자가 회원등록할 시 회원신상정보 테이블에서 유니크값인 이메일이 중복되는지 확인 -->
	<select id="memberByEmail" parameterType="String" resultType="String">
		select
			member_email
		from
			member
		where
			member_email = #{memberEmail};
	</select>
	
	
	<!-- 관리자가 학생 등록시 학부모 테이블에서 유니크값인 폰번호 중복 체크 -->
	<select id="parentByPhone" parameterType="String" resultType="String">
		select
			parent_phone
		from
			parent
		where
			parent_phone = #{inputParentPhone}
	</select>
	
	
	<!-- 관리자가 회원등록할 시 로그인 테이블 등록 -->
	<insert id="addMemberLogin" parameterType="com.cafe24.smart_academy.academy_manage.member.vo.MemberLogin">
		insert into member_login (
			 member_id
			,member_pw
			,member_level
			,member_registered_date
		) values (
			 #{memberId}
			,#{memberPw}
			,#{memberLevel}
			,curdate()
		)
	</insert>
	
	
	<!-- 관리자가 회원등록할 시 회원신상정보 테이블 등록 -->
	<insert id="addMember" parameterType="com.cafe24.smart_academy.academy_manage.member.vo.Member">
		insert into member (
			 member_id
			,member_name
			,member_birth
			,member_email
			,member_tel
			,member_phone
			,member_address
			,member_registered_date
		) values (
			 #{memberId}
			,#{memberName}
			,#{memberBirth}
			,#{memberEmail}
			,#{memberTel}
			,#{memberPhone}
			,#{memberAddress}
			,curdate()
		)
	</insert>
	
	
	<!--  -->
	<insert id="addParent" parameterType="com.cafe24.smart_academy.academy_manage.member.vo.Parent">
		insert into parent (
			 member_id
			,parent_name
			,parent_phone
			,parent_registered_date
		) values (
			 #{memberId}
			,#{parentName}
			,#{parentPhone}
			,curdate()
		)
	</insert>
	
	
	<!-- 관리자가 학생목록페이지로 이동하고자 할때 가져올 리스트 -->
	<select id="listStudentInfo" resultType="map">
		select
			 m.member_id					AS memberId
			,m.member_level					AS memberLevel
			,me.member_name					AS memberName
			,me.member_birth				AS memberBirth
			,me.member_registered_date
		from
			member_login m
		inner join
			member me
		on
			m.member_id = me.member_id
		where
			m.member_level = '학생';
	</select>
</mapper>